{% extends "contact/contact_form.html" %}
{% block contact_form %}
  {% set form_post_url = h.url_for(controller='ckanext.kata.controllers:ContactController', action='send_request_message', pkg_id=c.package.id) %}
  <form class="dataset-form form-horizontal" method="post" action={{form_post_url}} data-module="basic-form">
    <div class="contact">
      <p>{{ _("On this page you can send a message to the owner of the dataset to request access to the material.") }}</p>
      <label for="request-recipient">{{ _("Recipient") }}</label>
      <select id="request-recipient" name="recipient">
        {% for recipient in c.recipient_options %}
          <option value="{{ recipient.value }}" {% if loop.index0|string == c.recipient_index %}selected{% endif %}>{{ recipient.text }}</option>
        {% endfor %}
      </select><br />
      <label for="msg">{{ _("Message") }}</label>
      <textarea name="msg" id="msg" rows="10" cols="50"></textarea><br />
      <label for="from_address">{{ _("Your address") }}</label>
      {% set from = "" %}
      {% if c.userobj %}
        {% set from = c.userobj.email %}
        {% set fname = c.userobj.fullname %}
      {% endif %}
      <input type="email" name="from_address" id="from_address" value="{{ from }}"><br />
      <label for="from_name">{{ _("Your full name") }}</label>
      <input type="text" name="from_name" id="from_name" value="{{ fname }}"><br />
      <input type="hidden" name="check_this_out" value="{{ c.current_time }}">
      <div class="hidden">
        <label for="hp">{{ _('Leave this unchecked') }}</label>
        <input type="checkbox" name="hp" id="hp">
      </div>
      <br />
      <label for="accept_logging" class="accept_terms">{{ _('I understand that by sending this form details like time, message and IP will be logged by the service to prevent abuse') }}</label>
      <input type="checkbox" name="accept_logging" id="accept_logging">
    </div>
    {% if g.recaptcha_publickey and h.get_contact_captcha() %}
      <br /><br />
      <div class="control-group">
        <div class="controls kata-captcha-fix">
          <script type="text/javascript" src="http://www.google.com/recaptcha/api/challenge?k={{g.recaptcha_publickey}}"></script>
          <noscript>
            <iframe src="http://www.google.com/recaptcha/api/noscript?k={{g.recaptcha_publickey}}"
                    height="300" width="500" frameborder="0"></iframe><br/>
            <textarea name="recaptcha_challenge_field" rows="3" cols="40"> </textarea>
            <input type="hidden" name="recaptcha_response_field" value="manual_challenge" />
          </noscript>
        </div>
      </div>
    {% endif %}
  <br /><br />
  <input type="submit" value="Send"  class="btn btn-success"/>
  </form>
{% endblock %}
