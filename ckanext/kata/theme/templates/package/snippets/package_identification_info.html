{% import 'macros/form.html' as form %}
{% import 'macros/kata_form.html' as kata_form %}

<section class="module">
  <h2 class="module-heading-add-dataset">{{ _('Identification information of data') }}</h2>
  <div class="module-content">
    {% if data.name and data.name|length > 0 and errors.name|length == 0 %}
    <div class="control-group control-custom">
      <label class="control-label kata-input-comp" for="name-pid">{{ _('Permanent Identifier') }}</label>
      <div class="controls">
        <input id="name-pid" type="text" name="name" value="{{ data.name }}" class="kata-medium-input" readonly>
        {{ kata_form.tooltip(tooltip=_('Permanent identifier was already given. It can\'t be changed.')) }}
      </div>
    </div>
    {% else %}
      {% call form.input('name', id='name-pid', label=_('Permanent Identifier for data'), placeholder=_('will be automatically generated if empty'), value=data.name, error=errors.name, classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_('Field is compulsory but automatically generated if left empty.<br /><br />PID is a permanent, unique, identifier, preferably a URI. You can add your own identifier or use one generated by the service. <br /><br />The automatically generated PID is a URN identifier from the national library of Finland, of form \"urn:nbn:fi:csc-kata[unique number]\". Visit http://www.nationallibrary.fi/ for more information.')) }}
        {{ kata_form.warning_tooltip(tooltip=_('Note that the PID can NOT be edited after saving the dataset.')) }}
      {% endcall %}
    {% endif %}
    {% if errors and errors.get('pids', '') %}
      {% set pid_errors = [] %}
      {% for error in errors.get('pids') %}
        {% if pid_errors.append(error.get("id", "")[0]) %}{% endif %}
      {% endfor %}
    {% endif %}
    <div class="control-group control-custom{{ " error" if pid_errors }}">
      <label class="control-label kata-input-comp" for="new_version_pid">{{ _('Permanent Identifier for data version') }}</label>
      <div class="controls">
    {% if not (data.pids and data.pids|length > 0) or data.generate_version_pid == "on" %}
      <input id="field-pid" class="kata-medium-input" type="text" placeholder="{{ _('will be automatically generated if empty') }}" value="{{ data.new_version_pid }}" name="new_version_pid">
      <input type='checkbox' id='generate_version_pid' name='generate_version_pid' label='' class='checkbox checkbox-generate' checked='checked' title='{{ _("Check to automatically generate a permanent identifier.") }}'/>
      {{ kata_form.tooltip(tooltip=_('Field is compulsory but automatically generated if left empty with the checkbox checked.<br /><br />PID is a permanent, unique, identifier, preferably a URI. This specific PID is for the current data version. You can add your own identifier or use one generated by the service by leaving the text field empty and checking the checkbox next to the field. <br /><br />The automatically generated PID is a URN identifier from the national library of Finland, of form \"urn:nbn:fi:csc-kata[unique number]\". Visit http://www.nationallibrary.fi for more information.')) }}
      {{ kata_form.warning_tooltip(tooltip=_('Note that the version identifier can NOT be edited after saving the dataset, but you can add new version identifiers.')) }}
    {% else %}
      <input id="field-pid" class="kata-medium-input" type="text" placeholder="{{ _('insert new identifier or leave empty') }}" value="{{ data.new_version_pid }}" name="new_version_pid">
      <input type='checkbox' id='generate_version_pid' name='generate_version_pid' label='' class='checkbox checkbox-generate' title='{{ _("Check to automatically generate a permanent identifier.") }}'/>
      {{ kata_form.tooltip(tooltip=_('Field is not compulsory, a version identifier is already given.<br /><br />PID is a permanent, unique, identifier, preferably a URI. This specific PID is for the current data version. You can add a new one by typing it to the text field or by leaving the text field empty and checking the checkbox to automatically generate a new identifier.')) }}
      {{ kata_form.warning_tooltip(tooltip=_('Note that the version identifier can NOT be edited after saving the dataset, but you can add new version identifiers.')) }}
    {% endif %}
        {% if pid_errors and pid_errors is iterable %}<span class="error-block">{{ pid_errors|join('. ') }}</span>{% endif %}
      </div>
    </div>

    {% call form.input_block("last_modified", _('Modification date'), error=errors.version, control_classes=["kata-label-pluspad"], label_classes=['kata-input-comp']) %}
    <div class="control-group control-custom">
      <div data-module="dateselect-simple-kata">
        <input type="text" readonly id="last_modified" name="version" value="{{data.version}}" />
        {{ kata_form.tooltip(tooltip=_('Field is compulsory but an automatically generated date is provided.<br /><br />The modification date tells when the data has last been modified. Click the field to open a calendar tool to choose the modification date and time for this dataset. Accept and insert the date to the field by pressing the Done button. By default, the time zone is Z (Zulu Time Zone), which corresponds to the UTC time zone.<br /><br />Note that this tool requires JavaScript to be enabled in the browser.')) }}
      </div>
    </div>
  {% endcall %}
  </div>
</section>
