{% import 'macros/form.html' as form %}
{% import 'macros/kata_form.html' as kata_form %}

<section class="module">
  <h2 class="module-heading-add-dataset">{{ _('Actors and roles') }}</h2>
  <div class="module-content">
    {% set distributor = h.get_distributor(data) %}
    {% if distributor %}
      <input type="hidden" name="agent__999__role" value="distributor" />
      <input type="hidden" name="agent__999__name" value="{{ distributor.name }}" />
      <input type="hidden" name="agent__999__organisation" value="{{ distributor.organisation }}" />
    {% endif %}
    <h3 class="module-heading-add-dataset">{{ _('Distributor / publisher contact information') }}</h3>
    <div class="module-content">
      {#% set contact_name = data.maintainer if data.maintainer else user.fullname %#}
      {#% set contact_email = data.maintainer_email if data.maintainer_email else user.email %#}
      {% set contact = h.get_contact(data) %}
      {# If something added to __extras it may break current error rendering for authors and contacts. #}
        {% if errors and errors.get('__extras') %}
          {% set distributor_errors = [] %}
          {% for error in errors.get('__extras') %}
            {% if "contact" in error or "jakelijan" in error %}
              {% if distributor_errors.append(error) %}{% endif %}
            {% endif %}
          {% endfor %}
        {% endif %}

      {% call form.input('contact__0__name', label=_('Name'), id='contact__0__name', placeholder=_('John Doe'), value=contact.name, error=h.get_dict_field_errors(errors, 'contact', 0, 'name'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_('Field is compulsory.<br /><br />Type the name of the publisher. Publisher is someone or something that can be contacted if more information about the data is required or the person or organisation responsible for the data needs to be contacted.')) }}
      {% endcall %}

      {% call form.input('contact__0__phone', label=_('Phone'), id='contact__0__phone', placeholder=_('+35844122123'), value=contact.phone, error=h.get_dict_field_errors(errors, 'contact', 0, 'phone'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_('Field is compulsory.<br /><br />Type the contact phone number. The phone number must be in form \"+35812341234\".')) }}
      {% endcall %}

      {% call form.input('contact__0__email', label=_('Email'), id='contact__0__email', placeholder=_('john.doe@example.com'), value=contact.email, error=h.get_dict_field_errors(errors, 'contact', 0, 'email'), type='email', classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_('Field is compulsory.<br /><br />Type the contact e-mail address. The e-mail address is not shown publicly.')) }}
      {% endcall %}

      {% call form.input('contact__0__URL', label=_('Homepage'), id='contact__0__URL', placeholder=_('http://johndoe.com/contact'), value=contact.URL, error=h.get_dict_field_errors(errors, 'contact', 0, 'URL'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_('Field is compulsory.<br /><br />Type a valid web address to your web page. In case you don\'t have one, you could for example give an address to your research group\'s site or any site that could make it possible to contact the origin of the dataset in case of need.')) }}
      {% endcall %}

      {% if distributor_errors and distributor_errors is iterable %}<span class="error-block-kata">{{ distributor_errors|join('. ') }}</span>{% endif %}
    </div>
    <h3 class="module-heading-add-dataset">{{ _('Project that produced this dataset') }}</h3>
    <div class="module-content">
      <input type="checkbox" style="top: 0px;" name="projdis" onchange="$('#projdiv').toggle()" {% if h.get_funder(data) %}checked {% endif %}value="True" />{{ _('This dataset was produced in a project.') }}
    </div>
    <div class="module-content" id="projdiv" {% if not h.get_funder(data) %}style="display: none;"{% endif %}>
      {% set funder = h.get_funder(data) %}
      {% call form.input('agent__0__organisation', label=_('Name'), id='agent__0__organisation', placeholder=_('my project'), value=funder.organisation, error=h.get_dict_field_errors(errors, 'agent', 0, 'organisation'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_("Field is compulsory if checkbox \'This dataset was produced in a project.\' is checked.<br /><br />Type the project\'s name.")) }}
      {% endcall %}

      {% call form.input('agent__0__name', label=_('Funder'), id='agent__0__name', placeholder=_('my funder'), value=funder.name, error=h.get_dict_field_errors(errors, 'agent', 0, 'name'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_("Field is compulsory if checkbox \'This dataset was produced in a project.\' is checked.<br /><br />Type the project funder\'s name.")) }}
      {% endcall %}

      {% call form.input('agent__0__funding-id', label=_('Funding id'), id='agent__0__funding-id', placeholder=_('1234'), value=funder['funding-id'], error=h.get_dict_field_errors(errors, 'agent', 0, 'funding-id'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_("Field is compulsory if checkbox \'This dataset was produced in a project.\' is checked.<br /><br />Type the project\'s funding id. The funding id is not shown publicly.")) }}
      {% endcall %}

      {% call form.input('agent__0__URL', label=_('Homepage'), id='agent__0__URL', placeholder=_('http://myproject'), value=funder.URL, error=h.get_dict_field_errors(errors, 'agent', 0, 'URL'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_("Field is compulsory if checkbox \'This dataset was produced in a project.\' is checked.<br /><br />Type the project\'s homepage")) }}
      {% endcall %}
      <input type="hidden" id="agent__0__role" name="agent__0__role" value="funder" />
    </div>
    <h3 class="module-heading-add-dataset">{{ _('Owner information')}}</h3>
    <div class="module-content">
      {% set owner = h.get_owner(data) %}
      {% call form.input('agent__1__name', label=_('Owner identity'), id="agent__1__name", placeholder=_('identification URL or name'), value=owner.name, error=h.get_dict_field_errors(errors, 'agent', 1, 'name'), classes=['control-custom'], label_classes=['kata-input-comp'], attrs={'class': "kata-medium-input"}) %}
        {{ kata_form.tooltip(tooltip=_("Field is compulsory.<br /><br />Type the dataset owner\'s name or an identifier, for example an ORCID identifier.")) }}
      {% endcall %}
      <input type="hidden" id="agent__1__role" name="agent__1__role" value="owner" />
    </div>
  </div>
</section>
    