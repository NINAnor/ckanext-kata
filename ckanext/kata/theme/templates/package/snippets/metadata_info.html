{% set urn_url = h.get_urn_fi_address(pkg_dict) %}
{% set permanent_url = h.full_current_url() %}
{% set lang = h.lang() %}

<div class="dataset-section form-tab-content">

  <div class="form-row">
    <div class="form-label">{{ _('Dataset title') }}</div>
    <div class="form-content">
      <div class="etsin-multilang-display" data-module="etsin-multilang-display" data-module-currentlang="{{lang}}">

        <ul class="unstyled">
        {% for title in h.json_to_list(pkg_dict.title) %}
          {% set langvalue = h.get_language(title.lang) %}
          <li data-value="{{ title.lang }}"><a>{{ _(langvalue) }}</a></li>
        {% endfor %}
        </ul>
        {% for title in h.json_to_list(pkg_dict.title) %}
          <div class="multilang-field hidden" data-value="{{ title.lang}}">{{ title.value }}</div>
        {% endfor %}

      </div>
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Description') }}</div>
    <div class="form-content">
      {% if h.has_json_content(pkg_dict.notes) %}
        <div class="etsin-multilang-display" data-module="etsin-multilang-display" data-module-currentlang="{{ lang }}">

          <ul class="unstyled">
            {%- for description in h.json_to_list(pkg_dict.notes) -%}
            {% set langvalue = h.get_language(description.lang) %}
            <li data-value="{{ description.lang }}"><a>{{ _(langvalue) }}</a></li>
            {% endfor %}
          </ul>
          {%- for description in h.json_to_list(pkg_dict.notes) -%}
          <div class="multilang-field hidden" data-value="{{ description.lang }}">{{ h.render_markdown(description.value) }}</div>
          {% endfor %}

        </div>
      {% else %}
        <p>{{ _('No description') }}</p>
      {% endif%}
    </div>
  </div>

  {% if pkg_dict.language or pkg_dict.langdis %}
  <div class="form-row">
    <div class="form-label">{{ _('Language') }}</div>
    <div class="form-content">
        {% if pkg_dict.language %}{{ pkg_dict.language }}{% else %}{{ _('No language') }}{% endif%}
    </div>
  </div>
  {% endif %}


</div>
<div class="dataset-section form-tab-content">
  <!-- Keywords, Author, Distributor -->

  <div class="form-row">
    <div class="form-label">{{ _('Keywords') }}</div>
    <div class="form-content">
      {% snippet "package/snippets/tags.html", tags=pkg_dict.tags %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Field of science') }}</div>
    <div class="form-content">
      {{ h.disciplines_string_resolved(pkg_dict.discipline, 'okm-tieteenala') }}
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">

  <div class="form-row">
    <div class="form-label">{{ _('Author') }}</div>
    <div class="form-content">
      {% for role in pkg_dict.agent|groupby('role') if role.grouper != 'funder' %}
        {% for agent in role.list if agent.role == 'author' %}
          {% if loop.index0 > 0 %}
            <br><br>
          {% endif %}
          {{ agent.name }}
          {% if agent.organisation %}
          <br>{{ agent.organisation }}
          {% endif %}
          {% if agent.URL %}
          <br>{{ agent.URL }}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Organization') }}</div>
    <div class="form-content">
      {% if pkg_dict.get('organization') %}
        {% set organization=pkg_dict.organization %}
        {% link_for organization.title or organization.name, controller='organization', action='about', id=organization.name %}
      {% endif %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Distributor') }}</div>
    <div class="form-content">
      {% for contact in pkg_dict.contact %}
        {% if loop.index0 > 0 %}
          <br><br>
        {% endif %}
        {{ contact.name }}
        {% if contact.email %}
          <br>
          {% if contact.email == 'hidden' %}
            <a href="{{ h.url_for(controller='ckanext.kata.controllers:ContactController', action='render_contact_form', pkg_id=pkg_dict.name, recipient=loop.index0) }}">{{_('Send a message') }}</a>
          {% else %}
            {{ contact.email }}
          {% endif %}
        {% endif %}
        <br><a href="{{ contact.URL }}">{{ contact.URL }}</a>
        <br>{{ contact.phone }}
      {% endfor %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Owner') }}</div>
    <div class="form-content">
      {% for role in pkg_dict.agent|groupby('role') if role.grouper != 'funder' %}
        {% for agent in role.list if agent.role == 'owner' %}
          {% if loop.index0 > 0 %}
            <br><br>
          {% endif %}
          {{ agent.name }}
          {% if agent.organisation %}
          <br>{{ agent.organisation }}
          {% endif %}
          {% if agent.URL %}
          <br>{{ agent.URL }}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
  <div class="form-row">
    <div class="form-label">{{ _('Contributor') }}</div>
    <div class="form-content">
      {% for role in pkg_dict.agent|groupby('role') if role.grouper != 'funder' %}
        {% for agent in role.list if agent.role == 'contributor' %}
          {% if loop.index0 > 0 %}
            <br><br>
          {% endif %}
          {{ agent.name }}
          {% if agent.organisation %}
          <br>{{ agent.organisation }}
          {% endif %}
          {% if agent.URL %}
          <br>{{ agent.URL }}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
  <div class="form-row">
    <div class="form-label">{{ _('Other') }}</div>
    <div class="form-content">
      {% for role in pkg_dict.agent|groupby('role') if role.grouper != 'funder' %}
        {% for agent in role.list if agent.role not in ['contributor', 'owner', 'distributor', 'author', 'funder'] %}
          {% if loop.index0 > 0 %}
            <br><br>
          {% endif %}
          <b>{{ h.resolve_agent_role(agent.role) }}</b><br>
          {{ agent.name }}
          {% if agent.organisation %}
          <br>{{ agent.organisation }}
          {% endif %}
          {% if agent.URL %}
          <br>{{ agent.URL }}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">
  <!-- Licence -->

  <div class="form-row">
    <div class="form-label">{{ _('Dataset availability') }}</div>
    <div class="form-content">
        {{ _('This dataset is') }}
        {% if pkg_dict.availability == 'access_application' %}{{ _(' available via an access form in ') }}<a href="{{ pkg_dict.access_application_URL }}" target="_blank" class="download">{{ _('this link')}}</a> {% endif%}
        {% if pkg_dict.availability == 'direct_download' %}{{ _(' available freely ') }}{% if pkg_dict.direct_download_URL %} <a href="{{pkg_dict.direct_download_URL}}" class="download">{{ _('from this address') }}</a> {% endif %} {% endif %}
        {% if pkg_dict.availability == 'access_request' %}{{ _(' available via login ') }}{% if pkg_dict.access_request_URL %} <a href="{{pkg_dict.access_request_URL}}" class="download">{{ _('from this address') }}</a> {% endif %} {% endif %}
        {% if pkg_dict.availability == 'contact_owner' %}
            {{ _(' available by ') -}} {% link_for _('contacting the distributor'), controller='ckanext.kata.controllers:ContactController', action='render_request_form', pkg_id=pkg_dict.name, class_='download' %}.
        {% endif %}
        {% if pkg_dict.availability == 'through_provider' %}{{ _(' available through ') }}<a href="{{ pkg_dict.through_provider_URL }}" class="download">{{ _('data provider') }}</a> {% endif %}
        {% if not pkg_dict.availability %}{{ _(' available freely or availability is not specified') }}{% endif %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('License') }}</div>
    <div class="form-content">
      <p>
        {% if 'license_url' in pkg_dict %}
          <a href="{{ pkg_dict.license_url }}" rel="dc:rights" target="_blank">{{ pkg_dict.license_title }}</a>
        {% else %}
          <span property="dc:rights">{{ pkg_dict.license_title }}</span>
        {% endif %}
      </p>

    </div>
    <div class="form-label">{{ _('Copyright notice') }}</div>
    <div class="form-content">
      <p>
        {{ pkg_dict.license_URL }}
      </p>
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">
  <!-- Coverage -->

  <div class="form-row">
    <div class="form-label">{{ _('Geographical areas covered') }}</div>
    <div class="form-content">
      {{ pkg_dict.geographic_coverage }}
    </div>
  </div>

  <div class="form-row">
    <div class="form-label">{{ _('Period of time covered') }}</div>
    <div class="form-content">
      <!-- TODO: format timestamps to human readable format -->

      {% set tc_begin = pkg_dict.temporal_coverage_begin %}
      {% set tc_end = pkg_dict.temporal_coverage_end %}
      {% if tc_begin and tc_end %}
        {{tc_begin}}{{_(' to ') }}{{tc_end}}
      {% endif %}
      {% if tc_begin and not tc_end %}
        {{_('Begin')}}: {{tc_begin}}
      {% endif %}
      {% if tc_end and not tc_begin %}
        {{_('End')}}: {{tc_end}}
      {% endif %}
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">
  <!-- Funding -->

  <div class="form-row">
    <div class="form-label">{{ _('Project and funding information') }}</div>
    <div class="form-content">
    {% set funders = h.get_funders(pkg_dict) %}
    {% if funders %}
      <table class="table table-bordered table-condensed">
        <colgroup>
          <col width="20%">
          <col width="25%">
          <col width="30%">
          <col width="25%">
        </colgroup>
        <tbody>
        <tr>
          <th>{{ _('Project name') }}</th>
          <th>{{ _('Funder') }}</th>
          <th>{{ _('URL') }}</th>
          <th>{{ _('Funding id') }}</th>
        </tr>
        {% for f in funders %}
          <tr>
            <td>{{ f.name }}</td>
            <td>{{ f.organisation }}</td>
            <td><a href="{{ f.URL }}">{{ f.URL }}</a></td>
            <td>{{ f['fundingid'] }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
        <p>{{ _('No funding information is available.') }}</p>
    {% endif %}
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">
  <!-- Resources -->
  <div class="form-row">
    <div class="form-label">{{ _('Files') }}</div>
    <div class="form-content">
      <table class="form-inner-table">
        {% snippet "package/snippets/resources_list.html", pkg=pkg_dict, resources=pkg_dict.resources %}
      </table>
    </div>
  </div>
  <!-- IDs -->

  <div class="form-row">
    <div class="form-label">{{ _('Version') }}</div>
    <div class="form-content">{{ pkg_dict.version }}</div>
    <div class="form-label">{{ _('Identifiers') }}</div>
    <div class="form-content">
      <table class="form-inner-table">
        <tr>
          <th>{{ _('Permanent address for dataset') }}</th>
          <td><a href="{{ permanent_url }}">{{ permanent_url }}</a></td>
        </tr>
        {%- if urn_url -%}
        <tr>
          <th>{{ _('Uniform Resource Name') }}</th>
          <td><a href="{{ urn_url }}">{{ urn_url }}</a></td>
        </tr>
        {%- endif -%}
        <tr>
          <th>{{ _('Primary metadata identifier') }}</th>
          <td>{{ pkg_dict.id }}</td>
        </tr>
        <tr>
          <th>{{ _('Primary data identifier') }}</th>
          <td>{{ h.get_pids_by_type('data', pkg_dict, primary=True)[0]['id'] }}</td>
        </tr>
        {% for pid_type in h.get_pid_types() %}
          {% for pid in h.get_pids_by_type(pid_type, pkg_dict, primary=False) %}
            <tr>
              <th>{{ _(pid.get('type', '').capitalize() + ' identifier') }}</th>
              <td>{{ pid.id }}</td>
            </tr>
          {% endfor %}
        {% endfor %}
      </table>
    </div>
  </div>

</div>
<div class="dataset-section form-tab-content">
<!-- Dataset lifecycle events -->

  <div class="form-row">
    <div class="form-label">{{ _('Dataset lifecycle events') }}</div>
      {% if pkg_dict.event %}
        <div class="form-content">
          <!--<table class="form-inner-table">-->
          <table class="table table-bordered table-condensed">
            <colgroup>
              <col width="20%">
              <col width="25%">
              <col width="30%">
              <col width="25%">
            </colgroup>
            <tr>
              <th>{{ _('Event') }}</th>
              <th>{{ _('Who') }}</th>
              <th>{{ _('When') }}</th>
              <th>{{ _('Description') }}</th>
            </tr>
            {% for ev in pkg_dict.event %}
            <tr>
              <td class="dataset-details">{{ _(ev.get('type', ' ')) }}</td>
              <td class="dataset-details">{{ ev.get('who', ' ') }}</td>
              <td class="dataset-details">{{ ev.get('when', ' ') }}</td>
              <td class="dataset-details">{{ _(ev.get('descr', ' ')) }}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}
  </div>
</div>
<div class="dataset-section form-tab-content">
  <!-- Additional information / technical information about the data file -->
    <div class="form-row">
      <div class="form-label">{{ _('Additional information') }}</div>
        <div class="form-content">
          <table class="form-inner-table">
            {% if pkg_dict.mimetype %}
              <tr>
                <th class="dataset-label">{{ _('File format: MIME type') }}</th>
                <td class="dataset-details">{{ pkg_dict.mimetype }}</td>
               </tr>
            {% endif %}
            {%  if pkg_dict.format %}
              <tr>
                <th class="dataset-label">{{ _('File format') }}</th>
                <td class="dataset-details">{{ pkg_dict.format }}</td>
              </tr>
            {% endif %}
            {% if pkg_dict.algorithm and pkg_dict.checksum %}
              <tr>
                <th class="dataset-label">{{ _('Checksum') }}</th>
                <td class="dataset-details">{{ pkg_dict.checksum }}</td>
              </tr>
              <tr>
                <th class="dataset-label">{{ _('Algorithm') }}</th>
                <td class="dataset-details">{{ pkg_dict.algorithm }}</td>
              </tr>
            {% endif %}
          </table>
        </div>
      </div>
    </div>
</div>
{#
<div class="dataset-section form-tab-content">
  <!-- Additional info -->

</div>
 #}