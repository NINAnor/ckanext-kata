{% import 'macros/form.html' as form %}
{% import 'macros/kata_form.html' as kata_form %}

{% block package_basic_fields_org %}
{# if we have a default group then this wants remembering #}
{% if data.group_id %}
  <input type="hidden" name="groups__0__id" value="{{ data.group_id }}" />
{% endif %}

<div data-module="dataset-visibility">

  {% if data.owner_org %}
    {% if data.organization and data.owner_org == data.organization.id %}
      {% set selected_org = data.organization.title %}
    {% else %}
      {% set selected_org = h.resolve_org_name(data.owner_org) %}
    {% endif %}
  {% endif %}
  {% set org_attrs = {'class': 'kata-input-license',
                      'data-module': 'autocomplete', 'data-module-tags': 'false',
                      'data-module-source': '/api/2/util/organization/autocomplete?q=?',
                      'data-module-label': 'title', 'data-module-key': 'id'} %}
  <div class="kata-autocomplete error-block-autocomplete">
    {% call kata_form.input(
      'owner_org', id='field-organizations', label=_('Organisation') + '*',
      placeholder=_('Choose an organisation...'), value=selected_org,
      control_classes=['kata-medium-input'], label_classes=['kata-input-comp'],
      attrs=org_attrs)
    %}
      <div class="form-instructions dropdown">
        <a href="#" class="button dropdown-toggle" data-toggle="dropdown">
          <i class="icon-question-sign"></i>
        </a>
        <div class="dropdown-menu">
          {{ _("Select an organisation to which this dataset will be linked. When you start typing, you will get suggestions for matching organisations. Select the correct organization with a mouse click. If you can not find your organisation from the selection list, you can add a new organisation by writing it's name to this field.") }}
        </div>
      </div>
      {% if errors.owner_org %}
        <span class="error-block error-block-margin separate-error">
          {{ errors.owner_org[0] }}
        </span>
      {% endif %}
    {% endcall %}
  </div>

</div>

{% endblock %}
